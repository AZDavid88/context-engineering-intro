# Anti-Hallucination Development Protocol

**Generated by**: CODEFARM Anti-Hallucination Roadmap Generator  
**Date**: 2025-08-02  
**Status**: Systematic Development Framework  
**Purpose**: Process-enforcing guidelines preventing agentic coding hallucinations

---

## üéØ DEVELOPMENT PROTOCOL OVERVIEW

This protocol establishes **systematic constraints** that prevent agentic coding from deviating from validated research patterns. Every development action must follow this framework to ensure **research adherence** and **zero hallucination tolerance**.

---

## üìã PRE-DEVELOPMENT RESEARCH VALIDATION

### **MANDATORY STEP 1: Research Directory Consultation**

**Before any code implementation:**

1. **Identify Technology Domain**
   ```bash
   # Determine relevant research directory
   ls /workspaces/context-engineering-intro/projects/quant_trading/research/
   
   # Select applicable research domain:
   # - deap/ (for genetic algorithms)
   # - hyperliquid_documentation/ (for API integration)
   # - pandas_comprehensive/ (for data processing)
   # - vectorbt_comprehensive/ (for backtesting)
   # - prometheus_python_official/ (for monitoring)
   # - duckdb/ (for data storage)
   # - pydantic/ (for configuration)
   ```

2. **Read Research Summary**
   ```bash
   # MANDATORY: Read research_summary.md first
   cat research/[technology]/research_summary.md
   
   # Understand validated patterns and constraints
   # Identify applicable implementation examples
   # Note rate limits, API constraints, and requirements
   ```

3. **Validate Implementation Scope**
   ```markdown
   **Research Validation Checklist:**
   - [ ] Technology domain identified in research
   - [ ] Research summary reviewed and understood
   - [ ] Validated patterns identified for implementation
   - [ ] Constraints and limitations documented
   - [ ] Alternative approaches evaluated against research
   ```

### **MANDATORY STEP 2: Pattern Alignment Verification**

**For each implementation component:**

1. **API Method Validation**
   ```python
   # ‚úÖ REQUIRED: Verify method exists in research
   # Example for pandas operations:
   # CHECK: research/pandas_comprehensive/page_1_series_rolling.md
   df['SMA_20'] = df['close'].rolling(20).mean()  # ‚úÖ VALIDATED
   
   # ‚ùå FORBIDDEN: Undocumented methods
   df['custom'] = df['close'].custom_indicator()  # ‚ùå NOT IN RESEARCH
   ```

2. **Parameter Name Verification**
   ```python
   # ‚úÖ REQUIRED: Match research parameter names exactly
   # From: research/hyperliquid_documentation/6_rate_limits_and_constraints.md
   rate_limiter = RateLimiter(max_requests_per_minute=1200)  # ‚úÖ VALIDATED
   
   # ‚ùå FORBIDDEN: Invented parameter names
   rate_limiter = RateLimiter(custom_limit=5000)  # ‚ùå NOT DOCUMENTED
   ```

3. **Import Statement Validation**
   ```python
   # ‚úÖ REQUIRED: Use research-validated imports
   from deap import base, creator, tools, algorithms  # ‚úÖ FROM: research/deap/
   from prometheus_client import Counter, Histogram  # ‚úÖ FROM: research/prometheus_python_official/
   
   # ‚ùå FORBIDDEN: Undocumented imports
   from custom_genetic import SuperAlgorithm  # ‚ùå NOT IN RESEARCH
   ```

---

## üîí IMPLEMENTATION CONSTRAINTS

### **RESEARCH VALIDATION REQUIREMENTS**

#### **1. Genetic Algorithm Constraints**
**Research Source**: `/research/deap/research_summary.md`

```python
# ‚úÖ MANDATORY PATTERNS
def evaluate_fitness(individual):
    """Module-level function required for multiprocessing."""
    # Research requirement: no lambda closures
    return fitness_value,

# DEAP toolbox registration
toolbox.register("evaluate", evaluate_fitness)
toolbox.register("select", tools.selTournament, tournsize=3)

# ‚ùå FORBIDDEN PATTERNS
toolbox.register("evaluate", lambda ind: fitness(ind))  # ‚ùå Lambda breaks multiprocessing
custom_genetic_algorithm()  # ‚ùå Not in DEAP research
```

#### **2. Hyperliquid API Constraints**
**Research Source**: `/research/hyperliquid_documentation/`

```python
# ‚úÖ MANDATORY RATE LIMITS
REST_RATE_LIMIT = 1200  # requests per minute (from research)
WEBSOCKET_LIMIT = 100   # connections per IP (from research)

# ‚úÖ MANDATORY SUBSCRIPTION TYPES (exact from research)
class SubscriptionType(str, Enum):
    ALL_MIDS = "allMids"
    L2_BOOK = "l2Book"
    TRADES = "trades"
    
# ‚ùå FORBIDDEN PATTERNS
CUSTOM_SUBSCRIPTION = "customSignals"  # ‚ùå Not in documentation
rate_limit = 5000  # ‚ùå Exceeds documented limits
```

#### **3. Pandas Data Processing Constraints**
**Research Source**: `/research/pandas_comprehensive/`

```python
# ‚úÖ MANDATORY PANDAS PATTERNS
df['SMA'] = df['close'].rolling(window=20).mean()
df['EMA'] = df['close'].ewm(span=12).mean()
df['signal'] = df['price'].where(df['volume'] > threshold)

# ‚ùå FORBIDDEN PATTERNS
df['ta_signal'] = df['close'].ta.sma(20)  # ‚ùå pandas-ta not validated
df['custom'] = df['close'].technical_analysis()  # ‚ùå Method doesn't exist
```

#### **4. Monitoring System Constraints**
**Research Source**: `/research/prometheus_python_official/`

```python
# ‚úÖ MANDATORY PROMETHEUS PATTERNS
from prometheus_client import Counter, Histogram, Gauge
trades_counter = Counter('trades_total', 'Total number of trades')
latency_histogram = Histogram('request_duration_seconds', 'Request latency')

# ‚ùå FORBIDDEN PATTERNS
custom_metric = AdvancedCounter('custom')  # ‚ùå Not a Prometheus type
super_monitor = SupervisorMetrics()  # ‚ùå Custom implementation
```

---

## üîç CODE REVIEW ANTI-HALLUCINATION FRAMEWORK

### **SYSTEMATIC REVIEW PROTOCOL**

#### **Phase 1: Research Traceability Review**

```markdown
**Research Validation Questions:**
1. Is every API call documented in research?
2. Do all parameter names match research exactly?
3. Are all import statements from validated sources?
4. Do rate limits match documented constraints?
5. Are error handling patterns from research examples?

**Required Evidence:**
- Direct reference to research file for each component
- Line-by-line traceability to documentation
- Validation against research examples
```

#### **Phase 2: Implementation Pattern Review**

```markdown
**Pattern Compliance Questions:**
1. Does genetic algorithm use module-level functions?
2. Are WebSocket subscriptions using documented types?
3. Is pandas usage following official API patterns?
4. Are monitoring metrics using Prometheus standards?
5. Is configuration using Pydantic research patterns?

**Required Validation:**
- No lambda functions in genetic algorithms
- No custom API endpoints or methods
- No undocumented configuration parameters
- No rate limits exceeding research constraints
```

#### **Phase 3: Anti-Hallucination Verification**

```markdown
**Hallucination Detection Protocol:**
1. Scan for method calls not in research documentation
2. Verify all parameter names exist in official APIs
3. Check all import statements against research
4. Validate all numerical limits against documentation
5. Confirm all error handling follows research patterns

**Rejection Criteria:**
- Any API call not in research documentation
- Any parameter name not in official documentation
- Any import from non-validated source
- Any rate limit exceeding documented constraints
- Any custom implementation without research backing
```

---

## ‚ö° DEPENDENCY VALIDATION PROTOCOL

### **APPROVED LIBRARY USAGE**

#### **‚úÖ VALIDATED DEPENDENCIES**
```python
# Core frameworks (research-validated)
import pandas as pd           # ‚úÖ /research/pandas_comprehensive/
import numpy as np           # ‚úÖ Standard with pandas
from deap import base        # ‚úÖ /research/deap/
import asyncio              # ‚úÖ /research/asyncio_advanced/
from pydantic import BaseModel  # ‚úÖ /research/pydantic/

# API integrations (research-validated)
import aiohttp              # ‚úÖ HTTP client for Hyperliquid
import websockets           # ‚úÖ WebSocket for Hyperliquid
from prometheus_client import Counter  # ‚úÖ /research/prometheus_python_official/

# Data processing (research-validated)
import duckdb               # ‚úÖ /research/duckdb/
import pyarrow             # ‚úÖ /research/pyarrow/
import vectorbt as vbt     # ‚úÖ /research/vectorbt_comprehensive/
```

#### **‚ùå FORBIDDEN DEPENDENCIES**
```python
# Undocumented libraries
import pandas_ta           # ‚ùå Not validated in research
import custom_genetic      # ‚ùå No research backing
import experimental_api    # ‚ùå Not in research documentation
import unofficial_client   # ‚ùå Not validated against official API
```

### **DEPENDENCY VALIDATION CHECKLIST**

```markdown
**Before adding any new dependency:**
- [ ] Library exists in relevant research directory
- [ ] Usage patterns documented in research
- [ ] Version requirements specified in research
- [ ] Integration examples available in research
- [ ] No conflicts with existing validated dependencies
- [ ] Performance implications documented
- [ ] Security considerations addressed in research
```

---

## üö® ERROR HANDLING REQUIREMENTS

### **RESEARCH-BACKED ERROR PATTERNS**

#### **API Error Handling (Hyperliquid)**
```python
# ‚úÖ MANDATORY PATTERN (from research)
try:
    response = await client.get_market_data()
except aiohttp.ClientTimeout:
    # Research-documented timeout handling
    await asyncio.sleep(exponential_backoff)
    return await self.retry_with_backoff()
except aiohttp.ClientError as e:
    # Research-documented error pattern
    logger.error(f"API error: {e}")
    raise HyperliquidAPIError(f"Client error: {e}")
```

#### **Genetic Algorithm Error Handling (DEAP)**
```python
# ‚úÖ MANDATORY PATTERN (from research)
try:
    fitness = evaluate_individual(individual, data)
except Exception as e:
    # Research pattern: return invalid fitness
    return (-float('inf'),)  # Invalid fitness tuple
```

#### **Data Processing Error Handling (Pandas)**
```python
# ‚úÖ MANDATORY PATTERN (from research)
try:
    df['SMA'] = df['close'].rolling(20).mean()
except KeyError:
    # Research-documented missing column handling
    raise DataValidationError("Required 'close' column missing")
```

---

## üìä VALIDATION GATE REQUIREMENTS

### **MANDATORY VALIDATION GATES**

#### **Gate 1: Research Consultation**
- **Trigger**: Before any new implementation
- **Requirement**: Relevant research directory identified and reviewed
- **Output**: Research validation report
- **Approval**: Required before proceeding to implementation

#### **Gate 2: Pattern Compliance**
- **Trigger**: After implementation, before testing
- **Requirement**: All patterns match research documentation
- **Output**: Pattern compliance report
- **Approval**: Required before integration testing

#### **Gate 3: Anti-Hallucination Audit**
- **Trigger**: Before code review submission
- **Requirement**: Zero hallucination violations detected
- **Output**: Hallucination audit report
- **Approval**: Required before code review

#### **Gate 4: Integration Validation**
- **Trigger**: After code review, before deployment
- **Requirement**: System integration matches research behavior
- **Output**: Integration test results
- **Approval**: Required before production deployment

---

## üîÑ CONTINUOUS MONITORING

### **ONGOING VALIDATION REQUIREMENTS**

#### **Research Synchronization**
```markdown
**Monthly Research Updates:**
- Review new research documentation releases
- Update validation patterns for new API versions
- Synchronize constraint definitions with latest documentation
- Update dependency validation lists

**Quarterly Alignment Audits:**
- Full codebase scan against research documentation
- Identification of potential drift from validated patterns
- Update anti-hallucination constraints based on findings
- Refresh validation protocols based on new research
```

#### **Automated Validation**
```python
# Example: Automated pattern validation
def validate_genetic_algorithm_pattern(code_file):
    """Validate genetic algorithm implementation against DEAP patterns."""
    # Check for lambda functions in DEAP code
    if 'lambda' in genetic_code and 'toolbox.register' in genetic_code:
        return ValidationError("Lambda functions forbidden in DEAP implementations")
    
    # Verify module-level function usage
    if not has_module_level_fitness_function(code_file):
        return ValidationError("Module-level fitness function required")
    
    return ValidationSuccess("DEAP pattern compliance verified")
```

---

## üéØ SUCCESS CRITERIA

### **Anti-Hallucination Protocol Success Metrics**

1. **Research Traceability**: 100% of implementations traceable to research
2. **Pattern Compliance**: Zero deviations from validated patterns
3. **Dependency Validation**: All dependencies research-approved
4. **Error Handling**: All error patterns match research examples
5. **Validation Gates**: 100% gate passage rate
6. **Automated Detection**: Zero false positives, 100% hallucination detection

### **Continuous Improvement**
- **Documentation Updates**: Research alignment maintained as documentation evolves
- **Pattern Refinement**: Validation patterns improved based on implementation experience
- **Protocol Evolution**: Anti-hallucination framework enhanced based on detection results
- **Team Training**: Development team trained on protocol compliance

---

**üéØ PROTOCOL SUCCESS**: Systematic prevention of agentic coding hallucinations through research-enforced constraints, ensuring 100% implementation validity and zero deviation tolerance.